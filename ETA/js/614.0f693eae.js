"use strict";(self["webpackChunkvue_test2"]=self["webpackChunkvue_test2"]||[]).push([[614],{4614:function(t,e,s){s.r(e),s.d(e,{default:function(){return d}});var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("button",{staticClass:"btn btn-primary",on:{click:t.download_data}},[t._v("下載數據")]),s("div",{staticClass:"star-route"},[0==t.star_route_stop_eta_list.length?s("p",[t._v("沒有已儲存路線")]):t._e(),t.star_route_stop_eta_list.length>0?s("table",{staticClass:"table"},[t._m(0),s("tbody",t._l(t.star_route_stop_eta_list,(function(e){return s("router-link",{key:e.id,attrs:{tag:"tr",to:t.route_link("KMB",e.route,e.bound,e.service_type,e.seq)}},[s("td",{staticClass:"td-route"},[t._v(t._s(e.route)+" "),s("br"),s("span",{staticClass:"co-desc"},[t._v("九巴/龍運")])]),s("td",[s("div",[t._v(" 往 "+t._s(e.dest_tc)+" ")]),s("div",[t._v(" "+t._s(e.name_tc)+" ")])]),s("td",{class:["full"==t.display_type?"":"text-left"]},[s("div",[e.eta_1||e.eta_2||e.eta_3||!t.eta_loaded?t._e():s("div",[t._v(" X ")]),e.eta_1?s("div",[s("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_1.time_diff))]),s("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),"sm"!=t.display_type?s("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_1.time)+")")]):t._e(),e.eta_1.rmk_tc&&"full"==t.display_type?s("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_1.rmk_tc)+")")]):t._e()]):t._e(),e.eta_2?s("div",[s("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_2.time_diff))]),s("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),"sm"!=t.display_type?s("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_2.time)+")")]):t._e(),e.eta_2.rmk_tc&&"full"==t.display_type?s("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_2.rmk_tc)+")")]):t._e()]):t._e(),e.eta_3?s("div",[s("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_3.time_diff))]),s("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),"sm"!=t.display_type?s("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_3.time)+")")]):t._e(),e.eta_3.rmk_tc&&"full"==t.display_type?s("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_3.rmk_tc)+")")]):t._e()]):t._e()])])])})),1)]):t._e()])])},_=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("th",[t._v("路線")]),s("th",[t._v("方向")]),s("th",[t._v("時間")])])}],i=s(8638),o={name:"HomePage",data(){return{full_route_list:[],full_route_stop_list:[],full_stop_list:[],star_list:[],star_route_stop_eta_list:[],show_detail:!0,eta_loaded:!1,window_width:window.innerWidth}},computed:{display_type:function(){return this.window_width<370?"sm":this.window_width<500?"md":"full"}},created(){window.addEventListener("resize",this.onResize)},mounted(){let t=this;(async()=>{let e=[];e.push(i.Zt()),e.push(i.fO()),e.push(i.vw()),await Promise.all(e),t.full_route_list=JSON.parse(localStorage.getItem("KMBRouteList")),t.full_stop_list=JSON.parse(localStorage.getItem("KMBStopList")),t.full_route_stop_list=JSON.parse(localStorage.getItem("KMBRouteStopList")),t.star_list=JSON.parse(localStorage.getItem("KMBRouteStopStar")),t.star_list&&(t.star_route_stop_eta_list=t.star_list.map((e=>{let s=t.full_route_list.find((t=>t.route==e.route&&t.bound==e.bound&&t.service_type==e.service_type));return s&&(e.orig_tc=s.orig_tc,e.dest_tc=s.dest_tc),e})),t.star_route_stop_eta_list=t.star_route_stop_eta_list.map((e=>{let s=t.full_route_stop_list.find((t=>t.route==e.route&&t.bound==e.bound&&t.service_type==e.service_type&&t.seq==e.seq));return s&&(e.stop=s.stop),e})),t.star_route_stop_eta_list=t.star_route_stop_eta_list.map((e=>{let s=t.full_stop_list.find((t=>t.stop==e.stop));return s&&(e.name_tc=s.name_tc),e})),console.log("load eta"),this.load_eta(),setTimeout((()=>{}),500),setInterval((()=>{console.log("reload eta"),this.load_eta()}),1e4))})()},methods:{route_link:function(t,e,s,a,_){return"/"+t+"/"+e+"/"+s+"/"+a+"?seq="+_},load_eta:function(){(async()=>{for(let t=0;t<this.star_route_stop_eta_list.length;t++){let e=this.star_route_stop_eta_list[t],s=e.stop,a=e.route,_=e.service_type,o=e.bound,l=e.seq,r=await i.H(s,a,_);r=r.data;let n=r.find((t=>t.route==a&&t.dir==o&&t.service_type==_&&t.seq==l&&1==t.eta_seq)),d=r.find((t=>t.route==a&&t.dir==o&&t.service_type==_&&t.seq==l&&2==t.eta_seq)),u=r.find((t=>t.route==a&&t.dir==o&&t.service_type==_&&t.seq==l&&3==t.eta_seq));this.eta_loaded=!0,this.star_route_stop_eta_list=this.star_route_stop_eta_list.map((t=>(n&&n.eta&&n.route==t.route&&n.dir==t.bound&&n.service_type==t.service_type&&n.seq==t.seq&&(t.eta_1=n,t.eta_1.time=i.mr(n.eta),t.eta_1.time_diff=i.pm(n.eta)),d&&d.eta&&d.route==t.route&&d.dir==t.bound&&d.service_type==t.service_type&&d.seq==t.seq&&(t.eta_2=d,t.eta_2.time=i.mr(d.eta),t.eta_2.time_diff=i.pm(d.eta)),u&&u.eta&&u.route==t.route&&u.dir==t.bound&&u.service_type==t.service_type&&u.seq==t.seq&&(t.eta_3=u,t.eta_3.time=i.mr(u.eta),t.eta_3.time_diff=i.pm(u.eta)),t)))}})()},onResize(){this.window_width=window.innerWidth},download_data:function(){try{localStorage.clear(),(async()=>{let t=[];console.log("Get KMB / NWFB / CTB Route List"),console.log("Start time: "+new Date),t.push(i.Zt()),t.push(i.fO()),t.push(i.vw()),t.push(i.b1("NWFB")),t.push(i.b1("CTB")),await Promise.all(t).then((t=>{console.log("End time: "+new Date),console.log(JSON.stringify(t))})),console.log("Downloading NWFB / CTB Route & Stop List ..."),await i.xR(),console.log("Data download complete!")})()}catch(t){console.log("[Download data error]: "+t),alert("網絡錯誤，請重新下載數據！")}}}},l=o,r=s(1001),n=(0,r.Z)(l,a,_,!1,null,"2fed615b",null),d=n.exports}}]);
//# sourceMappingURL=614.0f693eae.js.map