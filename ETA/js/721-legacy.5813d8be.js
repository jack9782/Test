"use strict";(self["webpackChunkvue_test2"]=self["webpackChunkvue_test2"]||[]).push([[721],{721:function(t,e,s){s.r(e),s.d(e,{default:function(){return l}});var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("h4",[t._v(t._s(t.route)+" "+t._s(t.origin)+" 往 "+t._s(t.destination))]),i("div",{staticClass:"stop-list"},[i("table",{staticClass:"table text-left"},[t._m(0),i("tbody",t._l(t.route_stop_list,(function(e){return i("tr",{key:e.id,ref:"stop"+e.seq,refInFor:!0,on:{click:function(s){t.stop_seq_clicked=e.seq,t.stop_click(e.seq,e.stop)}}},[i("td",{staticClass:"td-seq"},[e.star?t._e():i("img",{attrs:{src:s(6101),width:"25px"},on:{click:function(s){return t.star_click(e.seq)}}}),e.star?i("img",{attrs:{src:s(8767),width:"25px"},on:{click:function(s){return t.star_click(e.seq)}}}):t._e(),i("span",[t._v(" "+t._s(e.seq))]),i("br")]),i("td",[i("div",{class:[e.seq==t.stop_seq_clicked?"font-weight-bold":""]},[t._v(t._s(e.name_tc))]),t.stop_seq_clicked==e.seq?i("div",[e.eta_1||e.eta_2||e.eta_3||!t.eta_loaded?t._e():i("div",[t._v(" 暫時沒有預定班次 ")]),e.eta_1?i("div",[i("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_1.time_diff))]),i("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),i("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_1.time)+")")]),e.eta_1.rmk_tc?i("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_1.rmk_tc)+")")]):t._e()]):t._e(),e.eta_2?i("div",[i("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_2.time_diff))]),i("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),i("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_2.time)+")")]),e.eta_2.rmk_tc?i("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_2.rmk_tc)+")")]):t._e()]):t._e(),e.eta_3?i("div",[i("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_3.time_diff))]),i("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),i("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_3.time)+")")]),e.eta_3.rmk_tc?i("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_3.rmk_tc)+")")]):t._e()]):t._e()]):t._e()])])})),0)])])])},r=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",{staticClass:"thead-dark"},[s("tr",[s("th",[t._v("站數")]),s("th",[t._v("巴士站")])])])}],a=s(7673),o=s(6198),n=(s(1249),s(9826),s(1539),s(8783),s(3948),s(4747),s(561),s(8862),s(8638)),_={name:"Citybus_ETA",data:function(){return{company:this.$route.params.company,route:this.$route.params.route,direction:this.$route.params.direction,origin:"",destination:"",stop_list:[],route_list:[],route_stop_list:[],current_route_stop_list:[],stop_seq_clicked:0,eta_loaded:!1}},computed:{star_image_src:function(){return this.current_route_stop_list.map((function(t){return t.star,"@/assets/star.png"}))}},mounted:function(){var t=this,e=this;(0,o.Z)((0,a.Z)().mark((function s(){var i,r,o,_,c,u,d,l;return(0,a.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,n.b1(e.company,e.route);case 2:return"NWFB"==e.company?e.route_list=JSON.parse(localStorage.getItem("NWFBRouteList")):"CTB"==e.company&&(e.route_list=JSON.parse(localStorage.getItem("CTBRouteList"))),i=e.route_list.find((function(t){return t.route==e.route})),i&&("outbound"==e.direction?(e.origin=i.orig_tc,e.destination=i.dest_tc):(e.origin=i.dest_tc,e.destination=i.orig_tc)),s.next=7,n.oc(e.company,e.route,e.direction);case 7:for(r=s.sent,r=r.data,o=[],e.stop_list=[],_=0;_<r.length;_++)c=r[_].stop,o.push(n.rW(c));return s.next=14,Promise.all(o).then((function(t){t.forEach((function(t){e.stop_list.push(t.data)}))}));case 14:r.map((function(t){var s=e.stop_list.find((function(e){return e.stop==t.stop}));return s&&s.name_tc&&(t.name_tc=s.name_tc),t})),e.route_stop_list=r,u=e.$route.query.seq,console.log("param_seq"+u),u&&(d=t.get_stop_id_clicked(u),console.log(d),e.stop_seq_clicked=u,e.stop_click(u,d)),l=JSON.parse(localStorage.getItem("NWFBCTBRouteStopStar")),l&&(e.route_stop_list=e.route_stop_list.map((function(t){var e="outbound"==t.direction?"O":"I",s=l.find((function(s){return s.route==t.route&&s.dir==e&&s.seq==t.seq}));return t.star=!!s,t})));case 21:case"end":return s.stop()}}),s)})))(),setInterval((function(){if(e.eta_loaded){var s=t.get_stop_id_clicked(e.stop_seq_clicked);e.stop_click(e.stop_seq_clicked,s)}}),1e4)},methods:{stop_click:function(t,e){var s,i=this;"outbound"==this.direction?s="O":"inbound"==this.direction&&(s="I"),(0,o.Z)((0,a.Z)().mark((function r(){var o,_,c,u;return(0,a.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,n.pb(i.company,e,i.route);case 2:o=r.sent,o=o.data,_=o.find((function(e){return e.route==i.route&&e.dir==s&&e.seq==t&&1==e.eta_seq})),c=o.find((function(e){return e.route==i.route&&e.dir==s&&e.seq==t&&2==e.eta_seq})),u=o.find((function(e){return e.route==i.route&&e.dir==s&&e.seq==t&&3==e.eta_seq})),i.route_stop_list=i.route_stop_list.map((function(t){return _&&_.eta&&(t.eta_1=_,t.eta_1.time=n.mr(_.eta),t.eta_1.time_diff=n.pm(_.eta)),c&&c.eta&&(t.eta_2=c,t.eta_2.time=n.mr(c.eta),t.eta_2.time_diff=n.pm(c.eta)),u&&u.eta&&(t.eta_3=u,t.eta_3.time=n.mr(u.eta),t.eta_3.time_diff=n.pm(u.eta)),t})),i.eta_loaded=!0;case 9:case"end":return r.stop()}}),r)})))()},get_stop_id_clicked:function(t){var e=this.route_stop_list.find((function(e){return e.seq==t}));return e&&e.stop?e.stop:0},star_click:function(t){var e,s=this;"outbound"==s.direction?e="O":"inbound"==s.direction&&(e="I");var i={route:s.route,dir:e,seq:t},r=localStorage.getItem("NWFBCTBRouteStopStar");r=JSON.parse(r),r||(r=[]);for(var a=-1,o=0;o<r.length;o++)if(r[o].route==i.route&&r[o].dir==i.dir&&r[o].seq==i.seq){a=o;break}if(a>-1){r.splice(a,1);for(var n=0;n<this.route_stop_list.length;n++){var _=this.route_stop_list[n];if(_.route==i.route&&_.dir==i.dir&&_.seq==i.seq){this.route_stop_list[n].star=!1;break}}}else{r.push(i);for(var c=0;c<this.route_stop_list.length;c++){var u=this.route_stop_list[c];if(u.route==i.route&&u.dir==i.dir&&u.seq==i.seq){this.route_stop_list[c].star=!0;break}}}localStorage.setItem("NWFBCTBRouteStopStar",JSON.stringify(r))}}},c=_,u=s(1001),d=(0,u.Z)(c,i,r,!1,null,"1af3d96a",null),l=d.exports},9826:function(t,e,s){var i=s(2109),r=s(2092).find,a=s(1223),o="find",n=!0;o in[]&&Array(1)[o]((function(){n=!1})),i({target:"Array",proto:!0,forced:n},{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),a(o)},561:function(t,e,s){var i=s(2109),r=s(7854),a=s(1400),o=s(9303),n=s(6244),_=s(7908),c=s(5417),u=s(6135),d=s(1194),l=d("splice"),p=r.TypeError,f=Math.max,m=Math.min,h=9007199254740991,v="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!l},{splice:function(t,e){var s,i,r,d,l,g,k=_(this),q=n(k),C=a(t,q),b=arguments.length;if(0===b?s=i=0:1===b?(s=0,i=q-C):(s=b-2,i=m(f(o(e),0),q-C)),q+s-i>h)throw p(v);for(r=c(k,i),d=0;d<i;d++)l=C+d,l in k&&u(r,d,k[l]);if(r.length=i,s<i){for(d=C;d<q-i;d++)l=d+i,g=d+s,l in k?k[g]=k[l]:delete k[g];for(d=q;d>q-i+s;d--)delete k[d-1]}else if(s>i)for(d=q-i;d>C;d--)l=d+i-1,g=d+s-1,l in k?k[g]=k[l]:delete k[g];for(d=0;d<s;d++)k[d+C]=arguments[d+2];return k.length=q-i+s,r}})},6101:function(t,e,s){t.exports=s.p+"img/star.5f894ed9.png"},8767:function(t,e,s){t.exports=s.p+"img/starred.5d1433f5.png"}}]);
//# sourceMappingURL=721-legacy.5813d8be.js.map