"use strict";(self["webpackChunkvue_test2"]=self["webpackChunkvue_test2"]||[]).push([[614],{4614:function(t,e,s){s.r(e),s.d(e,{default:function(){return d}});var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("button",{staticClass:"btn btn-primary",on:{click:t.download_data}},[t._v("下載數據")]),s("div",{staticClass:"star-route"},[0==t.star_route_stop_eta_list.length?s("p",[t._v("沒有已儲存路線")]):t._e(),t.star_route_stop_eta_list.length>0?s("table",{staticClass:"table"},[t._m(0),s("tbody",t._l(t.star_route_stop_eta_list,(function(e){return s("router-link",{key:e.id,attrs:{tag:"tr",to:t.route_link("KMB",e.route,e.bound,e.service_type,e.seq)}},[s("td",{staticClass:"td-route"},[t._v(t._s(e.route)+" "),s("br"),s("span",{staticClass:"co-desc"},[t._v("九巴/龍運")])]),s("td",[s("div",[t._v(" 往 "+t._s(e.dest_tc)+" ")]),s("div",[t._v(" "+t._s(e.name_tc)+" ")])]),s("td",{class:["full"==t.display_type?"":"text-left"]},[s("div",[e.eta_1||e.eta_2||e.eta_3||!t.eta_loaded?t._e():s("div",[t._v(" X ")]),e.eta_1?s("div",[s("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_1.time_diff))]),s("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),"sm"!=t.display_type?s("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_1.time)+")")]):t._e(),e.eta_1.rmk_tc&&"full"==t.display_type?s("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_1.rmk_tc)+")")]):t._e()]):t._e(),e.eta_2?s("div",[s("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_2.time_diff))]),s("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),"sm"!=t.display_type?s("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_2.time)+")")]):t._e(),e.eta_2.rmk_tc&&"full"==t.display_type?s("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_2.rmk_tc)+")")]):t._e()]):t._e(),e.eta_3?s("div",[s("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_3.time_diff))]),s("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),"sm"!=t.display_type?s("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_3.time)+")")]):t._e(),e.eta_3.rmk_tc&&"full"==t.display_type?s("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_3.rmk_tc)+")")]):t._e()]):t._e()])])])})),1)]):t._e()])])},r=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("th",[t._v("路線")]),s("th",[t._v("方向")]),s("th",[t._v("時間")])])}],i=s(7673),_=s(6198),n=(s(1539),s(8783),s(3948),s(1249),s(9826),s(8862),s(8638)),o={name:"HomePage",data:function(){return{full_route_list:[],full_route_stop_list:[],full_stop_list:[],star_list:[],star_route_stop_eta_list:[],show_detail:!0,eta_loaded:!1,window_width:window.innerWidth}},computed:{display_type:function(){return this.window_width<370?"sm":this.window_width<500?"md":"full"}},created:function(){window.addEventListener("resize",this.onResize)},mounted:function(){var t=this,e=this;(0,_.Z)((0,i.Z)().mark((function s(){var a;return(0,i.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return a=[],a.push(n.Zt()),a.push(n.fO()),a.push(n.vw()),s.next=6,Promise.all(a);case 6:e.full_route_list=JSON.parse(localStorage.getItem("KMBRouteList")),e.full_stop_list=JSON.parse(localStorage.getItem("KMBStopList")),e.full_route_stop_list=JSON.parse(localStorage.getItem("KMBRouteStopList")),e.star_list=JSON.parse(localStorage.getItem("KMBRouteStopStar")),e.star_list&&(e.star_route_stop_eta_list=e.star_list.map((function(t){var s=e.full_route_list.find((function(e){return e.route==t.route&&e.bound==t.bound&&e.service_type==t.service_type}));return s&&(t.orig_tc=s.orig_tc,t.dest_tc=s.dest_tc),t})),e.star_route_stop_eta_list=e.star_route_stop_eta_list.map((function(t){var s=e.full_route_stop_list.find((function(e){return e.route==t.route&&e.bound==t.bound&&e.service_type==t.service_type&&e.seq==t.seq}));return s&&(t.stop=s.stop),t})),e.star_route_stop_eta_list=e.star_route_stop_eta_list.map((function(t){var s=e.full_stop_list.find((function(e){return e.stop==t.stop}));return s&&(t.name_tc=s.name_tc),t})),console.log("load eta"),t.load_eta(),setTimeout((function(){}),500),setInterval((function(){console.log("reload eta"),t.load_eta()}),1e4));case 11:case"end":return s.stop()}}),s)})))()},methods:{route_link:function(t,e,s,a,r){return"/"+t+"/"+e+"/"+s+"/"+a+"?seq="+r},load_eta:function(){var t=this;(0,_.Z)((0,i.Z)().mark((function e(){var s,a;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=(0,i.Z)().mark((function e(s){var a,r,_,o,l,u,c,d,p,f;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.star_route_stop_eta_list[s],r=a.stop,_=a.route,o=a.service_type,l=a.bound,u=a.seq,e.next=8,n.H(r,_,o);case 8:c=e.sent,c=c.data,d=c.find((function(t){return t.route==_&&t.dir==l&&t.service_type==o&&t.seq==u&&1==t.eta_seq})),p=c.find((function(t){return t.route==_&&t.dir==l&&t.service_type==o&&t.seq==u&&2==t.eta_seq})),f=c.find((function(t){return t.route==_&&t.dir==l&&t.service_type==o&&t.seq==u&&3==t.eta_seq})),t.eta_loaded=!0,t.star_route_stop_eta_list=t.star_route_stop_eta_list.map((function(t){return d&&d.eta&&d.route==t.route&&d.dir==t.bound&&d.service_type==t.service_type&&d.seq==t.seq&&(t.eta_1=d,t.eta_1.time=n.mr(d.eta),t.eta_1.time_diff=n.pm(d.eta)),p&&p.eta&&p.route==t.route&&p.dir==t.bound&&p.service_type==t.service_type&&p.seq==t.seq&&(t.eta_2=p,t.eta_2.time=n.mr(p.eta),t.eta_2.time_diff=n.pm(p.eta)),f&&f.eta&&f.route==t.route&&f.dir==t.bound&&f.service_type==t.service_type&&f.seq==t.seq&&(t.eta_3=f,t.eta_3.time=n.mr(f.eta),t.eta_3.time_diff=n.pm(f.eta)),t}));case 15:case"end":return e.stop()}}),e)})),a=0;case 2:if(!(a<t.star_route_stop_eta_list.length)){e.next=7;break}return e.delegateYield(s(a),"t0",4);case 4:a++,e.next=2;break;case 7:case"end":return e.stop()}}),e)})))()},onResize:function(){this.window_width=window.innerWidth},download_data:function(){try{localStorage.clear(),(0,_.Z)((0,i.Z)().mark((function t(){var e;return(0,i.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=[],console.log("Get KMB / NWFB / CTB Route List"),console.log("Start time: "+new Date),e.push(n.Zt()),e.push(n.fO()),e.push(n.vw()),e.push(n.b1("NWFB")),e.push(n.b1("CTB")),t.next=10,Promise.all(e).then((function(t){console.log("End time: "+new Date),console.log(JSON.stringify(t))}));case 10:return console.log("Downloading NWFB / CTB Route & Stop List ..."),t.next=13,n.xR();case 13:console.log("Data download complete!");case 14:case"end":return t.stop()}}),t)})))()}catch(t){console.log("[Download data error]: "+t),alert("網絡錯誤，請重新下載數據！")}}}},l=o,u=s(1001),c=(0,u.Z)(l,a,r,!1,null,"2fed615b",null),d=c.exports},9826:function(t,e,s){var a=s(2109),r=s(2092).find,i=s(1223),_="find",n=!0;_ in[]&&Array(1)[_]((function(){n=!1})),a({target:"Array",proto:!0,forced:n},{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(_)}}]);
//# sourceMappingURL=614-legacy.ca9cef62.js.map