"use strict";(self["webpackChunkvue_test2"]=self["webpackChunkvue_test2"]||[]).push([[721],{721:function(t,e,s){s.r(e),s.d(e,{default:function(){return l}});var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("h4",[t._v(t._s(t.route)+" "+t._s(t.origin)+" 往 "+t._s(t.destination))]),i("div",{staticClass:"stop-list"},[i("table",{staticClass:"table text-left"},[t._m(0),i("tbody",t._l(t.route_stop_list,(function(e){return i("tr",{key:e.id,ref:"stop"+e.seq,refInFor:!0,on:{click:function(s){t.stop_seq_clicked=e.seq,t.stop_click(e.seq,e.stop)}}},[i("td",{staticClass:"td-seq"},[e.star?t._e():i("img",{attrs:{src:s(6101),width:"25px"},on:{click:function(s){return t.star_click(e.seq)}}}),e.star?i("img",{attrs:{src:s(8767),width:"25px"},on:{click:function(s){return t.star_click(e.seq)}}}):t._e(),i("span",[t._v(" "+t._s(e.seq))]),i("br")]),i("td",[i("div",{class:[e.seq==t.stop_seq_clicked?"font-weight-bold":""]},[t._v(t._s(e.name_tc))]),t.stop_seq_clicked==e.seq?i("div",[e.eta_1||e.eta_2||e.eta_3||!t.eta_loaded?t._e():i("div",[t._v(" 暫時沒有預定班次 ")]),e.eta_1?i("div",[i("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_1.time_diff))]),i("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),i("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_1.time)+")")]),e.eta_1.rmk_tc?i("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_1.rmk_tc)+")")]):t._e()]):t._e(),e.eta_2?i("div",[i("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_2.time_diff))]),i("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),i("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_2.time)+")")]),e.eta_2.rmk_tc?i("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_2.rmk_tc)+")")]):t._e()]):t._e(),e.eta_3?i("div",[i("span",{staticClass:"eta-time-diff"},[t._v(t._s(e.eta_3.time_diff))]),i("span",{staticClass:"eta-time-diff-desc"},[t._v(" 分鐘")]),i("span",{staticClass:"eta-time"},[t._v(" ("+t._s(e.eta_3.time)+")")]),e.eta_3.rmk_tc?i("span",{staticClass:"eta-rmk"},[t._v(" ("+t._s(e.eta_3.rmk_tc)+")")]):t._e()]):t._e()]):t._e()])])})),0)])])])},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",{staticClass:"thead-dark"},[s("tr",[s("th",[t._v("站數")]),s("th",[t._v("巴士站")])])])}],o=s(8638),r={name:"Citybus_ETA",data(){return{company:this.$route.params.company,route:this.$route.params.route,direction:this.$route.params.direction,origin:"",destination:"",stop_list:[],route_list:[],route_stop_list:[],current_route_stop_list:[],stop_seq_clicked:0,eta_loaded:!1}},computed:{star_image_src:function(){return this.current_route_stop_list.map((function(t){return t.star,"@/assets/star.png"}))}},mounted(){let t=this;(async()=>{await o.b1(t.company,t.route),"NWFB"==t.company?t.route_list=JSON.parse(localStorage.getItem("NWFBRouteList")):"CTB"==t.company&&(t.route_list=JSON.parse(localStorage.getItem("CTBRouteList")));let e=t.route_list.find((e=>e.route==t.route));e&&("outbound"==t.direction?(t.origin=e.orig_tc,t.destination=e.dest_tc):(t.origin=e.dest_tc,t.destination=e.orig_tc));let s=await o.oc(t.company,t.route,t.direction);s=s.data;let i=[];t.stop_list=[];for(let t=0;t<s.length;t++){let e=s[t].stop;i.push(o.rW(e))}await Promise.all(i).then((e=>{e.forEach((e=>{t.stop_list.push(e.data)}))})),s.map((e=>{let s=t.stop_list.find((t=>t.stop==e.stop));return s&&s.name_tc&&(e.name_tc=s.name_tc),e})),t.route_stop_list=s;let a=t.$route.query.seq;if(console.log("param_seq"+a),a){let e=this.get_stop_id_clicked(a);console.log(e),t.stop_seq_clicked=a,t.stop_click(a,e)}let r=JSON.parse(localStorage.getItem("NWFBCTBRouteStopStar"));r&&(t.route_stop_list=t.route_stop_list.map((t=>{let e="outbound"==t.direction?"O":"I",s=r.find((s=>s.route==t.route&&s.dir==e&&s.seq==t.seq));return t.star=!!s,t})))})(),setInterval((()=>{if(t.eta_loaded){let e=this.get_stop_id_clicked(t.stop_seq_clicked);t.stop_click(t.stop_seq_clicked,e)}}),1e4)},methods:{stop_click:function(t,e){let s;"outbound"==this.direction?s="O":"inbound"==this.direction&&(s="I"),(async()=>{let i=await o.pb(this.company,e,this.route);i=i.data;let a=i.find((e=>e.route==this.route&&e.dir==s&&e.seq==t&&1==e.eta_seq)),r=i.find((e=>e.route==this.route&&e.dir==s&&e.seq==t&&2==e.eta_seq)),_=i.find((e=>e.route==this.route&&e.dir==s&&e.seq==t&&3==e.eta_seq));this.route_stop_list=this.route_stop_list.map((t=>(a&&a.eta&&(t.eta_1=a,t.eta_1.time=o.mr(a.eta),t.eta_1.time_diff=o.pm(a.eta)),r&&r.eta&&(t.eta_2=r,t.eta_2.time=o.mr(r.eta),t.eta_2.time_diff=o.pm(r.eta)),_&&_.eta&&(t.eta_3=_,t.eta_3.time=o.mr(_.eta),t.eta_3.time_diff=o.pm(_.eta)),t))),this.eta_loaded=!0})()},get_stop_id_clicked:function(t){let e=this.route_stop_list.find((e=>e.seq==t));return e&&e.stop?e.stop:0},star_click:function(t){let e,s=this;"outbound"==s.direction?e="O":"inbound"==s.direction&&(e="I");let i={route:s.route,dir:e,seq:t},a=localStorage.getItem("NWFBCTBRouteStopStar");a=JSON.parse(a),a||(a=[]);let o=-1;for(let r=0;r<a.length;r++)if(a[r].route==i.route&&a[r].dir==i.dir&&a[r].seq==i.seq){o=r;break}if(o>-1){a.splice(o,1);for(let t=0;t<this.route_stop_list.length;t++){let e=this.route_stop_list[t];if(e.route==i.route&&e.dir==i.dir&&e.seq==i.seq){this.route_stop_list[t].star=!1;break}}}else{a.push(i);for(let t=0;t<this.route_stop_list.length;t++){let e=this.route_stop_list[t];if(e.route==i.route&&e.dir==i.dir&&e.seq==i.seq){this.route_stop_list[t].star=!0;break}}}localStorage.setItem("NWFBCTBRouteStopStar",JSON.stringify(a))}}},_=r,n=s(1001),c=(0,n.Z)(_,i,a,!1,null,"1af3d96a",null),l=c.exports},6101:function(t,e,s){t.exports=s.p+"img/star.5f894ed9.png"},8767:function(t,e,s){t.exports=s.p+"img/starred.5d1433f5.png"}}]);
//# sourceMappingURL=721.7f293bd8.js.map